<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Scores & Standings - Post9</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../static/styles.css">
    <style>
        body {
            background: linear-gradient(120deg, #0a1a2f 0%, #1e3350 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
        }
        .post9-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        .post9-title {
            font-size: 3.5rem;
            font-weight: 900;
            color: #fff;
            letter-spacing: 2px;
            text-shadow: 0 2px 8px #0a1a2f;
        }
        .post9-accent {
            color: #ff9900;
            font-weight: 900;
        }
        .post9-tagline {
            font-size: 1.25rem;
            color: #ff9900;
            font-weight: 600;
            text-align: center;
            margin-top: 0.5rem;
            letter-spacing: 1px;
        }
        .nav-btn {
            font-size: 1.2rem;
            font-weight: 700;
            color: #fff;
            background: none;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 2rem;
            transition: background 0.2s, color 0.2s;
        }
        .nav-btn:hover {
            background: #ff9900;
            color: #0a1a2f;
        }
        .nav-btn.active {
            background: #ff9900;
            color: #0a1a2f;
        }
        
        /* Professional score card styling */
        .professional-score-card {
            background: linear-gradient(120deg, #16243a 0%, #223a5e 100%);
            border-radius: 1rem;
            border: 2px solid rgba(255, 153, 0, 0.3);
            box-shadow: 0 4px 24px rgba(10,26,47,0.12);
            transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
            overflow: hidden;
        }
        .professional-score-card:hover {
            transform: translateY(-3px);
            border-color: #ff9900;
            box-shadow: 0 8px 32px rgba(255, 153, 0, 0.2);
        }
        
        /* Professional standings styling */
        .professional-standings {
            background: linear-gradient(120deg, #16243a 0%, #223a5e 100%);
            border-radius: 1rem;
            border: 1px solid rgba(255, 153, 0, 0.3);
            box-shadow: 0 4px 24px rgba(10,26,47,0.12);
            overflow: hidden;
        }
        
        .standings-header {
            background: linear-gradient(90deg, #ff9900 0%, #ffb84d 100%);
            color: #0a1a2f;
            padding: 1rem;
            font-weight: 700;
        }
        
        .sport-tab {
            padding: 0.75rem 1.5rem;
            margin: 0 0.25rem;
            border-radius: 0.75rem;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        .sport-tab:hover {
            background: rgba(255, 153, 0, 0.2);
            border-color: #ff9900;
            transform: translateY(-1px);
        }
        .sport-tab.active {
            background: linear-gradient(90deg, #ff9900 0%, #ffb84d 100%);
            color: #0a1a2f;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(255, 153, 0, 0.3);
        }
        
        .status-indicator {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .status-live {
            background: linear-gradient(90deg, #ef4444 0%, #dc2626 100%);
            color: white;
            animation: pulse 2s infinite;
        }
        
        .status-final {
            background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
            color: white;
        }
        
        .status-upcoming {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            color: white;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .team-stats {
            font-size: 0.875rem;
            color: #94a3b8;
        }
        
        .win-indicator {
            color: #22c55e;
            font-weight: 700;
        }
        
        .loss-indicator {
            color: #ef4444;
            font-weight: 700;
        }
        
        .loading-shimmer {
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0.1) 100%);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }
        
        .metric-badge {
            background: rgba(255, 153, 0, 0.1);
            border: 1px solid rgba(255, 153, 0, 0.3);
            color: #ff9900;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="min-h-screen p-4">
        <!-- Header -->
        <div class="text-center mb-10">
            <div class="post9-logo mb-6">
                <div class="text-6xl">üèÜ</div>
                <div>
                    <h1 class="post9-title">
                        Post<span class="post9-accent">9</span>
                    </h1>
                    <p class="post9-tagline">Professional Sports Intelligence Dashboard</p>
                    <p class="text-sm text-slate-300 mt-2 font-medium">Real-time Scores & Comprehensive Standings Analysis</p>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <nav class="flex space-x-4 mb-8 flex-wrap justify-center">
            <a href="/" class="nav-btn flex items-center gap-2">
                <span>‚Üê</span> Dashboard
            </a>
            <button onclick="location.reload()" class="nav-btn flex items-center gap-2">
                <span>üîÑ</span> Refresh Data
            </button>
            <button onclick="exportData()" class="nav-btn flex items-center gap-2">
                <span>üìä</span> Export
            </button>
        </nav>

        <!-- Sport Filters -->
        <div class="flex justify-center mb-8">
            <div class="flex space-x-3 p-3 bg-rgba(255,255,255,0.1) rounded-xl backdrop-blur-md border border-gray-600">
                <button onclick="filterBySport('all')" class="sport-tab active" id="tab-all">
                    <span class="block">All Sports</span>
                    <span id="count-all" class="text-xs opacity-75">Loading...</span>
                </button>
                <button onclick="filterBySport('NFL')" class="sport-tab" id="tab-NFL">
                    <span class="block">üèà NFL</span>
                    <span id="count-NFL" class="text-xs opacity-75">-</span>
                </button>
                <button onclick="filterBySport('NBA')" class="sport-tab" id="tab-NBA">
                    <span class="block">üèÄ NBA</span>
                    <span id="count-NBA" class="text-xs opacity-75">-</span>
                </button>
                <button onclick="filterBySport('MLB')" class="sport-tab" id="tab-MLB">
                    <span class="block">‚öæ MLB</span>
                    <span id="count-MLB" class="text-xs opacity-75">-</span>
                </button>
                <button onclick="filterBySport('NHL')" class="sport-tab" id="tab-NHL">
                    <span class="block">üèí NHL</span>
                    <span id="count-NHL" class="text-xs opacity-75">-</span>
                </button>
            </div>
        </div>

        <!-- Content Area -->
        <div class="max-w-7xl mx-auto">
            <!-- Recent Scores Section -->
            <div class="post9-card p-8 mb-10">
                <div class="flex flex-wrap items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <span class="text-4xl">üìä</span>
                        <div>
                            <h2 class="text-3xl font-bold text-white">Recent Scores</h2>
                            <p class="text-slate-300 text-sm font-medium mt-1">Latest game results and performance metrics</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-4 mt-4 lg:mt-0">
                        <div class="flex items-center gap-2">
                            <span id="scores-loading" class="text-sm text-orange-400 font-medium">Loading...</span>
                            <div id="scores-spinner" class="w-4 h-4 border-2 border-orange-400 border-t-transparent rounded-full animate-spin"></div>
                        </div>
                        <select id="daysFilter" onchange="loadScores()" class="bg-slate-700 border border-slate-600 text-white rounded-lg px-4 py-2 text-sm font-medium focus:border-orange-400 focus:outline-none transition-colors">
                            <option value="3">Last 3 days</option>
                            <option value="7" selected>Last 7 days</option>
                            <option value="14">Last 14 days</option>
                            <option value="30">Last 30 days</option>
                        </select>
                    </div>
                </div>
                
                <div id="scores-container" class="space-y-6">
                    <!-- Scores will be loaded here -->
                </div>
            </div>

            <!-- Division Standings Section -->
            <div class="post9-card p-8">
                <div class="flex flex-wrap items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <span class="text-4xl">üèÜ</span>
                        <div>
                            <h2 class="text-3xl font-bold text-white">Division Standings</h2>
                            <p class="text-slate-300 text-sm font-medium mt-1">Current league positions and performance analytics</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 mt-4 lg:mt-0">
                        <span id="standings-loading" class="text-sm text-orange-400 font-medium">Loading...</span>
                        <div id="standings-spinner" class="w-4 h-4 border-2 border-orange-400 border-t-transparent rounded-full animate-spin"></div>
                    </div>
                </div>
                
                <div id="standings-container">
                    <!-- Standings will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentSport = 'all';
        let scoresData = [];
        let standingsData = {};

        // Load data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadScores();
            loadStandings();
        });

        function filterBySport(sport) {
            currentSport = sport;
            
            // Update active tab
            document.querySelectorAll('.sport-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.getElementById(`tab-${sport}`).classList.add('active');
            
            // Reload data with filter
            loadScores();
            loadStandings();
        }
        
        function exportData() {
            const exportData = {
                scores: scoresData,
                standings: standingsData,
                exportDate: new Date().toISOString(),
                filter: currentSport
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `sports-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            // Show success message
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            notification.innerHTML = '‚úÖ Data exported successfully!';
            document.body.appendChild(notification);
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

        async function loadScores() {
            try {
                document.getElementById('scores-loading').textContent = 'Loading scores...';
                document.getElementById('scores-spinner').style.display = 'block';
                const days = document.getElementById('daysFilter').value;
                const sportParam = currentSport === 'all' ? '' : `&sport=${currentSport}`;
                
                const response = await fetch(`/api/recent-scores?days=${days}${sportParam}`);
                const data = await response.json();
                
                if (data.success) {
                    scoresData = data.scores;
                    renderScores();
                    updateScoreCounts();
                    document.getElementById('scores-loading').textContent = `${scoresData.length} games loaded`;
                    document.getElementById('scores-spinner').style.display = 'none';
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Error loading scores:', error);
                document.getElementById('scores-loading').textContent = 'Error loading scores';
                document.getElementById('scores-spinner').style.display = 'none';
                document.getElementById('scores-container').innerHTML = `
                    <div class="text-center text-red-400 p-8">
                        <div class="text-4xl mb-4">‚ö†Ô∏è</div>
                        <p class="text-lg font-medium">Failed to load recent scores</p>
                        <p class="text-sm mt-2">${error.message}</p>
                        <button onclick="loadScores()" class="mt-4 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                            Try Again
                        </button>
                    </div>
                `;
            }
        }

        async function loadStandings() {
            try {
                document.getElementById('standings-loading').textContent = 'Loading standings...';
                document.getElementById('standings-spinner').style.display = 'block';
                const sportParam = currentSport === 'all' ? '' : `?sport=${currentSport}`;
                
                const response = await fetch(`/api/standings${sportParam}`);
                const data = await response.json();
                
                if (data.success) {
                    standingsData = data.standings;
                    renderStandings();
                    
                    // Count total divisions
                    let divisionCount = 0;
                    Object.values(standingsData).forEach(sport => {
                        divisionCount += Object.keys(sport).length;
                    });
                    
                    document.getElementById('standings-loading').textContent = `${divisionCount} divisions loaded`;
                    document.getElementById('standings-spinner').style.display = 'none';
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Error loading standings:', error);
                document.getElementById('standings-loading').textContent = 'Error loading standings';
                document.getElementById('standings-spinner').style.display = 'none';
                document.getElementById('standings-container').innerHTML = `
                    <div class="text-center text-red-400 p-8">
                        <div class="text-4xl mb-4">‚ö†Ô∏è</div>
                        <p class="text-lg font-medium">Failed to load standings</p>
                        <p class="text-sm mt-2">${error.message}</p>
                        <button onclick="loadStandings()" class="mt-4 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors">
                            Try Again
                        </button>
                    </div>
                `;
            }
        }
        
        function updateScoreCounts() {
            const sportCounts = {};
            scoresData.forEach(score => {
                sportCounts[score.sport] = (sportCounts[score.sport] || 0) + 1;
            });
            
            // Update sport tab counts
            Object.keys(sportCounts).forEach(sport => {
                const countElement = document.getElementById(`count-${sport}`);
                if (countElement) {
                    countElement.textContent = `${sportCounts[sport]} games`;
                }
            });
            
            // Update all sports count
            const allCount = document.getElementById('count-all');
            if (allCount) {
                allCount.textContent = `${scoresData.length} games`;
            }
            
            // Set counts to 0 for sports with no games
            ['NFL', 'NBA', 'MLB', 'NHL'].forEach(sport => {
                const countElement = document.getElementById(`count-${sport}`);
                if (countElement && !sportCounts[sport]) {
                    countElement.textContent = '0 games';
                }
            });
        }

        function renderScores() {
            const container = document.getElementById('scores-container');
            
            if (scoresData.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-slate-400 p-12">
                        <div class="text-6xl mb-4">üì≠</div>
                        <p class="text-lg font-medium">No recent scores found for the selected criteria.</p>
                        <p class="text-sm mt-2">Try adjusting your filters or check back later.</p>
                    </div>
                `;
                return;
            }

            // Group scores by date
            const scoresByDate = {};
            scoresData.forEach(score => {
                if (!scoresByDate[score.date]) {
                    scoresByDate[score.date] = [];
                }
                scoresByDate[score.date].push(score);
            });

            let html = '';
            Object.keys(scoresByDate).sort().reverse().forEach(date => {
                const dateScores = scoresByDate[date];
                const formattedDate = new Date(date).toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                html += `
                    <div class="mb-8">
                        <div class="flex items-center gap-3 mb-4">
                            <h3 class="text-xl font-bold text-white">${formattedDate}</h3>
                            <div class="flex-1 h-px bg-gradient-to-r from-orange-400 to-transparent"></div>
                            <span class="metric-badge">${dateScores.length} games</span>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                `;

                dateScores.forEach(score => {
                    const isHomeWinner = score.winner === score.home_team;
                    const homeWinClass = isHomeWinner ? 'win-indicator' : '';
                    const awayWinClass = !isHomeWinner ? 'win-indicator' : '';
                    
                    // Determine status styling
                    let statusClass = 'status-final';
                    if (score.status.toLowerCase().includes('live') || score.status.toLowerCase().includes('in progress')) {
                        statusClass = 'status-live';
                    } else if (score.status.toLowerCase().includes('upcoming') || score.status.toLowerCase().includes('scheduled')) {
                        statusClass = 'status-upcoming';
                    }
                    
                    html += `
                        <div class="professional-score-card">
                            <div class="p-6">
                                <div class="flex justify-between items-center mb-4">
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs font-bold px-3 py-1 bg-orange-500 rounded-full text-white">
                                            ${score.sport}
                                        </span>
                                        <span class="status-indicator ${statusClass}">
                                            ${score.status}
                                        </span>
                                    </div>
                                    <span class="text-xs text-slate-400 font-medium">${score.game_time}</span>
                                </div>
                                
                                <div class="space-y-4">
                                    <div class="flex justify-between items-center py-3 border-b border-slate-600">
                                        <div class="flex items-center gap-3">
                                            <span class="text-lg font-bold text-white ${homeWinClass}">${score.home_team}</span>
                                            ${isHomeWinner ? '<span class="text-xs text-green-400 font-medium">HOME</span>' : '<span class="text-xs text-slate-500 font-medium">HOME</span>'}
                                        </div>
                                        <span class="text-2xl font-bold text-white ${homeWinClass}">${score.home_score}</span>
                                    </div>
                                    <div class="flex justify-between items-center py-3">
                                        <div class="flex items-center gap-3">
                                            <span class="text-lg font-bold text-white ${awayWinClass}">${score.away_team}</span>
                                            ${!isHomeWinner ? '<span class="text-xs text-green-400 font-medium">AWAY</span>' : '<span class="text-xs text-slate-500 font-medium">AWAY</span>'}
                                        </div>
                                        <span class="text-2xl font-bold text-white ${awayWinClass}">${score.away_score}</span>
                                    </div>
                                </div>
                                
                                <div class="mt-4 pt-4 border-t border-slate-600">
                                    <div class="flex justify-between text-xs text-slate-400">
                                        <span>Total: ${parseInt(score.home_score) + parseInt(score.away_score)}</span>
                                        <span>Margin: ${Math.abs(parseInt(score.home_score) - parseInt(score.away_score))}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });

                html += `
                        </div>
                    </div>
                `;
            });

            container.innerHTML = html;
        }

        function renderStandings() {
            const container = document.getElementById('standings-container');
            
            if (Object.keys(standingsData).length === 0) {
                container.innerHTML = `
                    <div class="text-center text-slate-400 p-12">
                        <div class="text-6xl mb-4">üèüÔ∏è</div>
                        <p class="text-lg font-medium">No standings data found for the selected sport.</p>
                        <p class="text-sm mt-2">Please try a different sport or check back later.</p>
                    </div>
                `;
                return;
            }

            let html = '';
            
            Object.keys(standingsData).forEach(sport => {
                const sportStandings = standingsData[sport];
                const sportIcon = getSportIcon(sport);
                
                html += `
                    <div class="mb-10">
                        <div class="flex items-center gap-3 mb-6">
                            <span class="text-3xl">${sportIcon}</span>
                            <h3 class="text-2xl font-bold text-white">${sport} Standings</h3>
                            <div class="flex-1 h-px bg-gradient-to-r from-orange-400 to-transparent"></div>
                            <span class="metric-badge">${Object.keys(sportStandings).length} divisions</span>
                        </div>
                        
                        <div class="grid gap-8 lg:grid-cols-2">
                `;
                
                Object.keys(sportStandings).forEach(division => {
                    const teams = sportStandings[division];
                    
                    html += `
                        <div class="professional-standings">
                            <div class="standings-header">
                                <h4 class="text-lg font-bold text-center">${division}</h4>
                            </div>
                            
                            <div class="p-6">
                                <div class="overflow-x-auto">
                                    <table class="w-full">
                                        <thead>
                                            <tr class="border-b border-slate-600 text-slate-300">
                                                <th class="text-left py-3 px-2 font-semibold text-sm">RANK</th>
                                                <th class="text-left py-3 px-2 font-semibold text-sm">TEAM</th>
                                                <th class="text-center py-3 px-2 font-semibold text-sm">W</th>
                                                <th class="text-center py-3 px-2 font-semibold text-sm">L</th>
                                                <th class="text-center py-3 px-2 font-semibold text-sm">PCT</th>
                                                <th class="text-center py-3 px-2 font-semibold text-sm">GB</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                    `;
                    
                    teams.forEach((team, index) => {
                        const isLeader = index === 0;
                        const rowClass = isLeader ? 'bg-gradient-to-r from-orange-500/20 to-transparent border-l-4 border-orange-400' : '';
                        const textClass = isLeader ? 'text-orange-300 font-bold' : 'text-white';
                        const rankBadge = isLeader ? 
                            '<span class="bg-orange-500 text-white text-xs px-2 py-1 rounded-full font-bold">1st</span>' : 
                            `<span class="text-slate-400 font-medium">${index + 1}</span>`;
                        
                        // Calculate win percentage color
                        const pct = parseFloat(team.win_percentage);
                        let pctColor = 'text-white';
                        if (pct >= 0.600) pctColor = 'text-green-400';
                        else if (pct >= 0.500) pctColor = 'text-yellow-400';
                        else if (pct < 0.400) pctColor = 'text-red-400';
                        
                        html += `
                            <tr class="border-b border-slate-700 hover:bg-slate-700/30 transition-colors ${rowClass}">
                                <td class="py-4 px-2">${rankBadge}</td>
                                <td class="py-4 px-2">
                                    <div>
                                        <span class="${textClass} font-semibold">${team.team}</span>
                                        ${isLeader ? '<div class="text-xs text-orange-400 font-medium mt-1">Division Leader</div>' : ''}
                                    </div>
                                </td>
                                <td class="text-center py-4 px-2 font-bold text-green-400">${team.wins}</td>
                                <td class="text-center py-4 px-2 font-bold text-red-400">${team.losses}</td>
                                <td class="text-center py-4 px-2 font-bold ${pctColor}">${team.win_percentage}</td>
                                <td class="text-center py-4 px-2 font-medium text-slate-300">${team.games_behind}</td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                        </tbody>
                                    </table>
                                </div>
                                
                                <div class="mt-4 pt-4 border-t border-slate-600">
                                    <div class="flex justify-between text-xs text-slate-400">
                                        <span>Last Updated: ${new Date().toLocaleDateString()}</span>
                                        <span>Total Teams: ${teams.length}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        function getSportIcon(sport) {
            const icons = {
                'NFL': 'üèà',
                'NBA': 'üèÄ',
                'MLB': '‚öæ',
                'NHL': 'üèí',
                'NCAA Football': 'üèà',
                'NCAA Basketball': 'üèÄ'
            };
            return icons[sport] || 'üèÜ';
        }
    </script>
</body>
</html>