<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post9 Sports Investing Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../static/styles.css">
    <style>
        body {
            background: linear-gradient(120deg, #0a1a2f 0%, #1e3350 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', 'Roboto', 'Arial', sans-serif;
        }
        .post9-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        .post9-title {
            font-size: 3.5rem;
            font-weight: 900;
            color: #fff;
            letter-spacing: 2px;
            text-shadow: 0 2px 8px #0a1a2f;
        }
        .post9-accent {
            color: #ff9900;
            font-weight: 900;
        }
        .post9-tagline {
            font-size: 1.25rem;
            color: #ff9900;
            font-weight: 600;
            text-align: center;
            margin-top: 0.5rem;
            letter-spacing: 1px;
        }
        .metric-card, .table-container, .modal-content {
            background: rgba(255,255,255,0.95);
            border-radius: 1rem;
            box-shadow: 0 4px 24px rgba(10,26,47,0.12);
        }
        .nav-btn {
            font-size: 1.2rem;
            font-weight: 700;
            color: #fff;
            background: none;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 2rem;
            transition: background 0.2s, color 0.2s;
        }
        .nav-btn:hover {
            background: #ff9900;
            color: #0a1a2f;
        }
        .post9-btn {
            background: linear-gradient(90deg, #ff9900 0%, #ffb84d 100%);
            color: #0a1a2f;
            font-weight: 700;
            border-radius: 2rem;
            box-shadow: 0 2px 8px #ff9900a0;
            transition: transform 0.1s;
        }
        .post9-btn:hover {
            transform: scale(1.05);
            background: linear-gradient(90deg, #ffb84d 0%, #ff9900 100%);
        }
        .post9-card {
            border: 2px solid #ff9900;
            box-shadow: 0 2px 12px #ff990080;
        }
        /* Stats Grid Layout */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
        }
        .stats-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 1rem;
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            border: 1px solid transparent;
            transition: transform 0.3s, border-color 0.3s;
        }
        .stats-card:hover {
            transform: translateY(-5px);
            border-color: #ff9900;
        }
        .stats-icon {
            font-size: 2.5rem;
            display: block;
            margin-bottom: 0.5rem;
        }
        .stats-label {
            font-size: 0.875rem;
            color: #a0aec0;
            margin-bottom: 0.25rem;
        }
        .stats-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            display: block;
            margin-bottom: 0.25rem;
        }
        .stats-trend {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
            border-radius: 1rem;
            color: #fff;
        }
        .stats-trend.positive {
            background: rgba(76, 175, 80, 0.2);
        }
        .stats-trend.negative {
            background: rgba(244, 67, 54, 0.2);
        }
    </style>
    <script>
        function showPage(pageId) {
            const pages = ['dashboard-page', 'investments-page', 'account-page'];
            pages.forEach(id => {
                const pageElement = document.getElementById(id);
                if (pageElement) {
                    pageElement.style.display = (id === pageId) ? 'block' : 'none';
                }
            });
            if (pageId === 'investments-page') {
                // Load cached investments instead of automatically refreshing
                if (typeof window.loadCachedInvestments === 'function') {
                    window.loadCachedInvestments();
                } else {
                    console.error("loadCachedInvestments is not defined.");
                }
            } else if (pageId === 'account-page') {
                // Load API status when account page is shown
                if (typeof window.refreshApiStatus === 'function') {
                    setTimeout(() => window.refreshApiStatus(), 100);
                }
            }
        }
    </script>
</head>
<body class="flex flex-col items-center justify-start min-h-screen p-8">
    <nav class="flex space-x-4 mb-6">
        <button onclick="showPage('dashboard-page')" class="nav-btn">Dashboard</button>
        <button onclick="showPage('investments-page')" class="nav-btn">Available Investments</button>
        <button onclick="showPage('account-page')" class="nav-btn">Account</button>
    </nav>
    <div id="message-box" class="message-box"></div>
    <div id="loading-spinner" class="spinner hidden"></div>
    <div class="container mx-auto">
        <header class="text-center mb-8">
            <div class="post9-logo mb-2">
                <img src="/static/post9-logo.png" alt="Post9 Logo" style="height:64px;">
                <span class="post9-title"><em>Post</em><span class="post9-accent">9</span></span>
            </div>
            <div class="post9-tagline">Stop Betting. Start Investing.</div>
            <p class="text-xl text-gray-300 mt-2">Professional Analytics & Bot Management</p>
            <p class="text-sm text-gray-400 mt-2">User ID: <span id="user-id">Loading...</span></p>
        </header>
        <div id="dashboard-page">
            <section id="overall-stats-section" class="mb-12">
                <h2 class="text-2xl font-bold mb-6 text-white">Overall Stats</h2>
                <div id="stats-container" class="stats-grid">
                    <div class="stats-card">
                        <span class="stats-icon">üí∞</span>
                        <span class="stats-label">Total Profit</span>
                        <span id="total-profit" class="stats-value">$0.00</span>
                        <span class="stats-trend" id="profit-trend"></span>
                    </div>
                    <div class="stats-card">
                        <span class="stats-icon">üé≤</span>
                        <span class="stats-label">Total Wagers</span>
                        <span id="total-wagers" class="stats-value">0</span>
                    </div>
                    <div class="stats-card">
                        <span class="stats-icon">üèÜ</span>
                        <span class="stats-label">Win Rate</span>
                        <span id="win-rate" class="stats-value">0.00%</span>
                    </div>
                    <div class="stats-card">
                        <span class="stats-icon">üöÄ</span>
                        <span class="stats-label">Best Bot</span>
                        <span id="best-bot-name" class="stats-value">-</span>
                        <span id="best-bot-profit" class="stats-trend"></span>
                    </div>
                    <div class="stats-card">
                        <span class="stats-icon">‚ö†Ô∏è</span>
                        <span class="stats-label">Worst Bot</span>
                        <span id="worst-bot-name" class="stats-value">-</span>
                        <span id="worst-bot-profit" class="stats-trend negative"></span>
                    </div>
                </div>
                <div id="stats-breakdown-inline"></div>
            </section>
            <section class="table-container mb-12 post9-card">
                <h2 class="text-2xl font-bold mb-4 text-white">Active Bots</h2>
                <div id="active-bots-container" class="overflow-x-auto rounded-lg shadow-sm post9-card">
                    <p id="active-bots-loading" class="text-center text-gray-500">Loading active bots...</p>
                </div>
            </section>
            <section class="table-container mb-12 post9-card">
                <h2 class="text-2xl font-bold mb-4 text-white">Bot Manager</h2>
                <button type="button" class="post9-btn p-3 mb-4" onclick="showModal('add-bot-modal')">Add Bot</button>
                <div id="inactive-bots-container" class="overflow-x-auto rounded-lg shadow-sm post9-card">
                    <p id="inactive-bots-loading" class="text-center text-gray-500">Loading inactive bots...</p>
                </div>
            </section>
            <section class="table-container post9-card">
                <h2 class="text-2xl font-bold mb-4 text-white">Strategy Editor</h2>
                <button type="button" class="post9-btn p-3 mb-4" onclick="showModal('add-strategy-modal')">Add Strategy</button>
                <div id="strategies-container" class="overflow-x-auto rounded-lg shadow-sm post9-card">
                    <p id="strategies-loading" class="text-center text-gray-500">Loading strategies...</p>
                </div>
            </section>
        </div>
        <!-- Add Bot Modal -->
        <div id="add-bot-modal" class="modal">
            <div class="modal-content post9-card">
                <span class="modal-close" onclick="closeModal('add-bot-modal')">&times;</span>
                <h3 class="text-xl font-bold mb-4 text-white">Add Bot</h3>
                <form id="add-bot-form" class="flex flex-col gap-4">
                    <input type="text" name="name" placeholder="Bot Name" required>
                    <input type="number" name="starting_balance" placeholder="Starting Balance" required>
                    <input type="number" name="bet_percentage" placeholder="Bet %" required>
                    <input type="number" name="max_bets_per_week" placeholder="Max Bets/Week" required>
                    <select name="strategy_id" id="strategy-select" required></select>
                    <select name="sport" required>
                        <option value="NBA">NBA</option>
                        <option value="NFL">NFL</option>
                        <option value="MLB">MLB</option>
                        <option value="NCAAF">NCAAF</option>
                        <option value="NCAAB">NCAAB</option>
                    </select>
                    <select name="bet_type" required>
                        <option value="Moneyline">Moneyline</option>
                        <option value="Spread">Spread</option>
                        <option value="Totals">Totals</option>
                    </select>
                    <button type="submit" class="post9-btn p-3 mt-2">Add Bot</button>
                </form>
            </div>
        </div>
        <!-- Add Strategy Modal -->
        <div id="add-strategy-modal" class="modal">
            <div class="modal-content post9-card">
                <span class="modal-close" onclick="closeModal('add-strategy-modal')">&times;</span>
                <h3 class="text-xl font-bold mb-4 text-white">Add Strategy</h3>
                <form id="add-strategy-form" class="flex flex-col gap-4">
                    <input type="text" name="name" placeholder="Strategy Name" required>
                    <select name="type" required>
                        <option value="basic">Basic</option>
                        <option value="recovery">Recovery</option>
                    </select>
                    <select name="linked_strategy_id" id="linked-strategy-select">
                        <option value="">Link Recovery Strategy (Optional)</option>
                    </select>
                    <input type="text" name="description" placeholder="Description">
                    <button type="submit" class="post9-btn p-3 mt-2">Add Strategy</button>
                </form>
            </div>
        </div>
        <div id="investments-page" class="mt-8 post9-card rounded-lg shadow-lg p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-6 text-white">Available Investments</h2>
            <div id="sport-tabs-container" class="mb-6"></div>
            <div id="cache-indicator" class="w-3 h-3 rounded-full bg-blue-500 inline-block mr-2"></div>
            <span id="cache-text" class="text-sm text-gray-300"></span>
            <div id="investments-container" class="mt-6"></div>
            <div id="no-investments-message" class="text-center text-gray-400 mt-8 hidden">No investments available.</div>
            <button id="refresh-investments-btn" class="post9-btn px-4 py-2 mt-6"><span id="refresh-icon" class="inline-block mr-2">üîÑ</span>Refresh Investments</button>
        </div>
        <div id="account-page" class="mt-8 post9-card rounded-lg shadow-lg p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-6 text-white">Account</h2>
            <div id="api-status-section" class="mb-6 post9-card p-4">
                <h3 class="text-lg font-bold text-white mb-2">API Usage</h3>
                <div class="flex flex-col gap-2">
                    <div class="flex items-center gap-2">
                        <span class="stats-label">Requests Remaining:</span>
                        <span id="api-requests-remaining" class="stats-value">-</span>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="stats-label">Requests Used:</span>
                        <span id="api-requests-used" class="stats-value">-</span>
                    </div>
                </div>
            </div>
            <div id="auth-section" class="mb-8">
                <form id="signin-form-element" class="flex flex-col gap-4 mb-4 post9-card p-4">
                    <input type="email" name="email" placeholder="Email" required>
                    <input type="password" name="password" placeholder="Password" required>
                    <button type="submit" class="post9-btn p-3">Sign In</button>
                </form>
                <form id="signup-form-element" class="flex flex-col gap-4 mb-4 post9-card p-4" style="display:none;">
                    <input type="email" name="email" placeholder="Email" required>
                    <input type="password" name="password" placeholder="Password" required>
                    <input type="password" name="confirmPassword" placeholder="Confirm Password" required>
                    <button type="submit" class="post9-btn p-3">Sign Up</button>
                </form>
                <button id="demo-signin-btn" class="post9-btn p-3">Demo Sign In</button>
            </div>
            <div id="account-management-section" class="mb-8 hidden post9-card p-4">
                <div class="mb-4">
                    <span class="text-lg font-bold text-white">Welcome, <span id="user-email-display">Demo Mode</span></span>
                </div>
                <form id="profile-form" class="flex flex-col gap-4 mb-4">
                    <input type="email" id="profile-email" name="email" placeholder="Email">
                    <input type="text" id="profile-display-name" name="displayName" placeholder="Display Name">
                    <button type="submit" class="post9-btn p-3">Update Profile</button>
                </form>
                <form id="password-form" class="flex flex-col gap-4 mb-4">
                    <input type="password" name="currentPassword" placeholder="Current Password">
                    <input type="password" name="newPassword" placeholder="New Password">
                    <input type="password" name="confirmNewPassword" placeholder="Confirm New Password">
                    <button type="submit" class="post9-btn p-3">Change Password</button>
                </form>
                <button id="logout-btn" class="post9-btn p-3 mb-2">Sign Out</button>
                <button id="delete-account-btn" class="post9-btn p-3 bg-red-600 text-white">Delete Account</button>
            </div>
        </div>
    </div>
    
    <div id="bot-details-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="window.closeModal('bot-details-modal')">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Edit Bot: <span id="modal-bot-name"></span></h2>
            <form id="edit-bot-form" class="space-y-4">
                <input type="hidden" id="modal-bot-id">
                <div>
                    <label for="modal-name" class="block text-sm font-medium text-gray-700">Name</label>
                    <input type="text" id="modal-name" name="name" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="modal-strategy" class="block text-sm font-medium text-gray-700">Strategy</label>
                    <select id="modal-strategy" name="strategy_id" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        </select>
                </div>
                <div>
                    <label for="modal-balance" class="block text-sm font-medium text-gray-700">Current Balance</label>
                    <input type="number" step="0.01" id="modal-balance" name="current_balance" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500" disabled>
                </div>
                <div>
                    <label for="modal-bet-percent" class="block text-sm font-medium text-gray-700">Bet % of Balance</label>
                    <input type="number" step="0.01" id="modal-bet-percent" name="bet_percentage" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label for="modal-max-bets" class="block text-sm font-medium text-gray-700">Max Bets / Week</label>
                    <input type="number" id="modal-max-bets" name="max_bets_per_week" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Allowable Platforms</label>
                    <div class="mt-1 space-y-2">
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="modal-platform-draftkings" name="allowable_platforms" value="DraftKings" 
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm text-gray-700">DraftKings</span>
                        </label>
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="modal-platform-fanduel" name="allowable_platforms" value="FanDuel" 
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm text-gray-700">FanDuel</span>
                        </label>
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="modal-platform-betmgm" name="allowable_platforms" value="BetMGM" 
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm text-gray-700">BetMGM</span>
                        </label>
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="modal-platform-caesars" name="allowable_platforms" value="Caesars" 
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm text-gray-700">Caesars</span>
                        </label>
                        <label class="flex items-center space-x-3">
                            <input type="checkbox" id="modal-platform-pointsbet" name="allowable_platforms" value="PointsBet" 
                                   class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm text-gray-700">PointsBet</span>
                        </label>
                    </div>
                    <p class="text-xs text-gray-500 mt-2">Select which sportsbooks this bot can consider for placing bets</p>
                </div>
                <button type="submit" class="w-full p-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-300">Save Changes</button>
            </form>
        </div>
    </div>
    
    <div id="strategy-details-modal" class="modal">
        <div class="modal-content max-w-2xl">
            <span class="modal-close" onclick="window.closeModal('strategy-details-modal')">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Edit Strategy: <span id="strategy-modal-name"></span></h2>
            <form id="edit-strategy-form" class="space-y-4">
                <input type="hidden" id="strategy-modal-id">
                <div>
                    <label for="strategy-modal-description" class="block text-sm font-medium text-gray-700">Description</label>
                    <textarea id="strategy-modal-description" name="description" rows="4" class="mt-1 block w-full p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Parameters</label>
                    <div id="strategy-modal-parameters" class="mt-1 space-y-3">
                        </div>
                </div>
                <button type="submit" class="w-full p-3 bg-purple-600 text-white font-semibold rounded-lg hover:bg-purple-700 transition duration-300">Save Changes</button>
            </form>
        </div>
    </div>

    <div id="history-modal" class="modal">
        <div class="modal-content max-w-2xl">
            <span class="modal-close" onclick="window.closeModal('history-modal')">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Bet History for <span id="history-bot-name"></span></h2>
            <div class="overflow-y-auto max-h-96">
                <table class="w-full divide-y divide-gray-200">
                    <thead>
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Teams</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Wager</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Odds</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Payout</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Outcome</th>
                        </tr>
                    </thead>
                    <tbody id="history-table-body" class="bg-white divide-y divide-gray-200">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="bot-log-modal" class="modal">
        <div class="modal-content max-w-2xl">
            <span class="modal-close" onclick="window.closeModal('bot-log-modal')">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Bot Log for <span id="log-bot-name"></span></h2>
            <div class="overflow-y-auto max-h-96 bg-gray-100 p-4 rounded-md text-sm font-mono whitespace-pre-wrap">
                <pre id="bot-log-content"></pre>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content max-w-md">
            <span class="modal-close" onclick="window.closeModal('settings-modal')">&times;</span>
            <h2 class="text-2xl font-bold mb-4">Investment Settings</h2>
            <form id="settings-form" class="space-y-4">
                <div>
                    <label class="flex items-center space-x-3">
                        <input type="checkbox" id="auto-refresh-checkbox" name="auto_refresh_on_login" 
                               class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500">
                        <div class="flex flex-col">
                            <span class="text-sm font-medium text-gray-700">Auto-refresh on login</span>
                            <span class="text-xs text-gray-500">Automatically fetch fresh data when you open the app</span>
                        </div>
                    </label>
                </div>
                <div>
                    <label for="cache-expiry-select" class="block text-sm font-medium text-gray-700 mb-2">Cache expiry time</label>
                    <select id="cache-expiry-select" name="cache_expiry_minutes" 
                            class="w-full p-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500">
                        <option value="15">15 minutes</option>
                        <option value="30">30 minutes</option>
                        <option value="60">1 hour</option>
                        <option value="120">2 hours</option>
                        <option value="1440">24 hours</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1">How long to keep cached data before considering it stale</p>
                </div>
                <div class="bg-gray-50 p-3 rounded-md">
                    <h4 class="text-sm font-semibold text-gray-700 mb-2">Cache Statistics</h4>
                    <div class="space-y-1 text-xs text-gray-600">
                        <div>Last refresh: <span id="settings-last-refresh">-</span></div>
                        <div>Cached games: <span id="settings-cached-games">-</span></div>
                        <div>API calls saved: <span id="settings-api-saved">-</span></div>
                    </div>
                </div>
                <button type="submit" class="w-full p-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-300">
                    Save Settings
                </button>
            </form>
        </div>
    </div>
    
    <!-- Stats Breakdown Modal -->
    <div id="stats-breakdown-modal" class="modal">
        <div class="modal-content post9-card">
            <span class="modal-close" onclick="closeModal('stats-breakdown-modal')">&times;</span>
            <h3 id="stats-breakdown-title" class="text-xl font-bold mb-4 text-white">Stat Breakdown</h3>
            <div id="stats-breakdown-content"></div>
        </div>
    </div>
    
    <script type="module" src="../static/scripts/scripts.js"></script>
</body>
</html>